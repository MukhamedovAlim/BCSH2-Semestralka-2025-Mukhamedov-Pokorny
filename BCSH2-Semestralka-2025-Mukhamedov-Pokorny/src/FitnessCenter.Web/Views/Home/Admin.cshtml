@{
    ViewData["Title"] = "Admin – Přehled";
    Layout = "_AppLayout";
    ViewBag.Active = ViewBag.Active ?? "Admin";

    int membersCount = ViewBag.MembersCount is int mc ? mc : 0;
    int trainersCount = ViewBag.TrainersCount is int tc ? tc : 0;
    int lessonsToday = ViewBag.LessonsToday is int lt ? lt : 0;
    int pendingPayments = ViewBag.PendingPayments is int pp ? pp : 0;

    DateTime today = ViewBag.Today is DateTime d ? d : DateTime.Today;

    // ---- pro funkční boxy (DB funkce) ----
    int fitkoId = ViewBag.FitkoId is int f ? f : 1;
    DateTime periodFrom = ViewBag.PeriodFrom is DateTime pf ? pf : DateTime.Today.AddDays(-30);
    DateTime periodTo = ViewBag.PeriodTo is DateTime pt ? pt : DateTime.Today;

    int activeMembersFunc = ViewBag.ActiveMembersFunc is int amf ? amf : 0;
    decimal incomeFunc = ViewBag.IncomeFunc is decimal inc ? inc : 0m;
    string lessonFuncText = ViewBag.LessonFuncText as string ?? "—";

    // stejné jako jinde – vyber fitka přes SelectListItem
    var fitness = ViewBag.FitnessCenters as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>
                  ?? ViewBag.Fitka as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>
                  ?? Enumerable.Empty<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>();
}

<!-- Úvodní panel -->
<div class="glass p-3 mb-4">
    <div class="d-flex align-items-center justify-content-between flex-wrap">
        <div>
            <h3 class="text-white mb-1">Ahoj, admine @(User.Identity?.Name ?? "") 👋</h3>
            <div class="text-white-50">Dnes je @today.ToString("dddd d. MMMM yyyy")</div>
        </div>
        <div class="mt-2 mt-md-0">
            <a href="@Url.Action("Create", "Members")" class="btn btn-sm btn-warning">
                + Přidat člena
            </a>
        </div>
    </div>

    <hr class="border-secondary my-3" />

    <div class="row g-3">
        <!-- Členové -->
        <div class="col-12 col-sm-6 col-xl-3">
            <div class="tile glass h-100">
                <div class="d-flex justify-content-between">
                    <h5 class="text-white mb-2">Členové</h5>
                    <span class="badge bg-info">@membersCount</span>
                </div>
                <div class="text-white-50 small mb-2">Aktivní záznamy v systému.</div>
                <a class="stretched-link" href="@Url.Action("Index", "Members")"></a>
            </div>
        </div>

        <!-- Trenéři -->
        <div class="col-12 col-sm-6 col-xl-3">
            <div class="tile glass h-100">
                <div class="d-flex justify-content-between">
                    <h5 class="text-white mb-2">Trenéři</h5>
                    <span class="badge bg-info">@trainersCount</span>
                </div>
                <div class="text-white-50 small mb-2">Správa trenérů a kvalifikací.</div>
                <a class="stretched-link" href="@Url.Action("Index", "AdminTrainers")"></a>
            </div>
        </div>

        <!-- Dnešní lekce -->
        <div class="col-12 col-sm-6 col-xl-3">
            <div class="tile glass h-100">
                <div class="d-flex justify-content-between">
                    <h5 class="text-white mb-2">Přehled Lekcí</h5>
                    <span class="badge bg-warning">@lessonsToday</span>
                </div>
                <div class="text-white-50 small mb-2">Rozvrh a kapacity.</div>
                <a class="stretched-link" href="@Url.Action("Index", "AdminLessons")"></a>
            </div>
        </div>

        <!-- Vybavení -->
        <div class="col-12 col-sm-6 col-xl-3">
            <div class="tile glass h-100">
                <div class="d-flex justify-content-between">
                    <h5 class="text-white mb-2">Vybavení</h5>
                    <span class="badge bg-info">@((int)(ViewBag.EquipmentCount ?? 0))</span>
                </div>
                <div class="text-white-50 small mb-2">Přehled a správa vybavení.</div>
                <a class="stretched-link" href="@Url.Action("Index", "Equipment")"></a>
            </div>
        </div>
    </div>
</div>

<!-- Rychlé akce -->
<div class="glass p-3">
    <div class="d-flex align-items-center justify-content-between flex-wrap">
        <h4 class="text-white mb-0">Rychlé akce</h4>
    </div>
    <div class="row g-3 mt-1">
        <div class="col-12 col-md-6 col-xl-3">
            <div class="tile glass quick-tile position-relative h-100">
                <h5 class="text-white mb-1">Log operací</h5>
                <div class="text-white-50 small">Poslední záznamy: <strong>@((int)(ViewBag.LogCount ?? 0))</strong></div>
                <a href="@Url.Action("Index", "AdminLogs")" class="stretched-link"></a>
            </div>
        </div>

        <div class="col-12 col-md-6 col-xl-3">
            <div class="tile glass quick-tile position-relative h-100">
                <h5 class="text-white mb-1">Prodej členství</h5>
                <div class="text-white-50 small">Založit členství a platbu.</div>
                <a href="@Url.Action("Sell", "AdminMemberships")" class="stretched-link"></a>
            </div>
        </div>

        <div class="col-12 col-md-6 col-xl-3">
            <div class="tile glass quick-tile position-relative h-100">
                <h5 class="text-white mb-1">Lekce & rozvrh</h5>
                <div class="text-white-50 small">Plánování, kapacity, lektoři.</div>
                <a href="@Url.Action("Index", "AdminLessons")" class="stretched-link"></a>
            </div>
        </div>
        <div class="col-12 col-md-6 col-xl-3">
            <div class="tile glass quick-tile position-relative h-100">
                <h5 class="text-white mb-1">Platby</h5>
                <div class="text-white-50 small">Neuhrazené: <strong>@pendingPayments</strong></div>
                <a href="@Url.Action("Index", "Payments")" class="stretched-link"></a>
            </div>
        </div>
    </div>
</div>

<!-- ===== Boxy napojené na DB FUNKCE ===== -->
<div class="glass p-3 mt-4">
    <div class="d-flex align-items-center justify-content-between flex-wrap">
        <h4 class="text-white mb-0">Funkční přehled (DB funkce)</h4>
    </div>

    <!-- Filtr (fitko + období) -->
    <div class="mt-3">
        <form method="get" asp-action="Admin" class="row g-2 align-items-end">
            <div class="col-12 col-md-3">
                <label class="form-label text-white">Fitness centrum</label>
                <select name="fitko" class="form-select">
                    @foreach (var it in fitness)
                    {
                        var sel = (fitkoId.ToString() == it.Value) ? "selected" : null;
                        <option value="@it.Value" @sel>@it.Text</option>
                    }
                </select>
            </div>
            <div class="col-6 col-md-3">
                <label class="form-label text-white">Od</label>
                <input type="date" name="od" class="form-control" value="@periodFrom.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-6 col-md-3">
                <label class="form-label text-white">Do</label>
                <input type="date" name="do" class="form-control" value="@periodTo.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-12 col-md-3">
                <button class="btn btn-warning w-100" type="submit">Použít</button>
            </div>
        </form>
    </div>

    <!-- Výstupy funkcí -->
    <div class="row g-3 mt-1">
        <div class="col-12 col-md-4">
            <div class="glass p-3 h-100">
                <div class="text-white-50 small">Aktivní členové (fitko)</div>
                <div class="display-6 text-white">@activeMembersFunc</div>
            </div>
        </div>

        <div class="col-12 col-md-4">
            <div class="glass p-3 h-100">
                <div class="text-white-50 small">Příjem za období</div>
                <div class="text-white">@periodFrom.ToString("d.M.yyyy") – @periodTo.ToString("d.M.yyyy")</div>
                <div class="display-6 text-white mt-1">@incomeFunc.ToString("N0") Kč</div>
            </div>
        </div>

        <div class="col-12 col-md-4">
            <div class="glass p-3 h-100">
                <div class="text-white-50 small">Statistika nejbližší lekce</div>
                <div class="text-white">@lessonFuncText</div>
            </div>
        </div>
    </div>
</div>

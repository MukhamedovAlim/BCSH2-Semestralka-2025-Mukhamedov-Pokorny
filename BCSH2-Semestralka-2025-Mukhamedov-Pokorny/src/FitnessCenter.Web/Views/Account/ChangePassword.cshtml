@model FitnessCenter.Web.Models.ChangePasswordViewModel

@{
    ViewData["Title"] = "Změna hesla";
    Layout = "_AuthLayout";
}

<h1 class="h4 text-center mb-2 text-white">Změna hesla</h1>

<p class="text-center text-white-50 mb-4">
    Zadej své nové heslo. Aktuální heslo zadávat nemusíš, protože bylo resetováno.
</p>

@if (TempData["Err"] is string err && !string.IsNullOrWhiteSpace(err))
{
    <div class="alert alert-danger small py-2 px-3 mb-3" role="alert">
        @err
    </div>
}

@if (TempData["Ok"] is string ok && !string.IsNullOrWhiteSpace(ok))
{
    <div class="alert alert-success small py-2 px-3 mb-3" role="alert">
        @ok
    </div>
}

<form method="post" action="/Account/ChangePassword" novalidate>
    @Html.AntiForgeryToken()

    <!-- Souhrn chyb z ModelState -->
    @if (!ViewData.ModelState.IsValid && ViewData.ModelState.ErrorCount > 0)
    {
        <div class="alert alert-danger small py-2 px-3 mb-3" role="alert">
            @string.Join(" | ",
            ViewData.ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage))
    </div>
        }

    <!-- NOVÉ HESLO -->
    <div class="mb-3 position-relative">
        <input type="password"
               id="NewPassword"
               name="NewPassword"
               class="form-control form-control-lg"
               autocomplete="new-password"
               placeholder="Nové heslo" />

        <span class="toggle-eye"
              data-target="NewPassword"
              style="position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;">
            👁
        </span>
    </div>

    <!-- POTVRZENÍ HESLA -->
    <div class="mb-3 position-relative">
        <input type="password"
               id="ConfirmPassword"
               name="ConfirmPassword"
               class="form-control form-control-lg"
               autocomplete="new-password"
               placeholder="Potvrzení nového hesla" />

        <span class="toggle-eye"
              data-target="ConfirmPassword"
              style="position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;">
            👁
        </span>
    </div>

    <button type="submit" class="btn btn-primary btn-lg w-100 mt-2">
        Změnit heslo
    </button>
</form>

<div class="mt-3 text-center">
    <a href="/" class="text-white-50 text-decoration-none">
        Pokračovat na hlavní stránku
    </a>
</div>

@section scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".toggle-eye").forEach(function (el) {
                el.addEventListener("click", function () {
                    const targetId = this.getAttribute("data-target");
                    const input = document.getElementById(targetId);
                    if (!input) return;

                    input.type = (input.type === "password") ? "text" : "password";
                });
            });
        });
    </script>
}

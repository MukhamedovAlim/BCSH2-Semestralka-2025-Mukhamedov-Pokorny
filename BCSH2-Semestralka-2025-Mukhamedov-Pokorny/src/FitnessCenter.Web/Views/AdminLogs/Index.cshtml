@model IEnumerable<FitnessCenter.Infrastructure.Repositories.LogRow>
@{
    ViewData["Title"] = "Log operací";
    Layout = "_AppLayout";

    ViewBag.HideMainNav = true;

    string FormatOperace(string op) => op switch
    {
        "INSERT" => "Vytvoření",
        "UPDATE" => "Úprava",
        "DELETE" => "Smazání",
        _ => op
    };

    string OperaceBadgeClass(string op) => op switch
    {
        "INSERT" => "bg-success",
        "UPDATE" => "bg-warning text-dark",
        "DELETE" => "bg-danger",
        _ => "bg-secondary"
    };

    string CleanPopis(string? raw)
    {
        if (string.IsNullOrWhiteSpace(raw))
            return "";

        // 1) když máš více řádků, vezmeme jen první (shrnutí)
        var nl = raw.IndexOfAny(new[] { '\r', '\n' });
        if (nl > 0)
            return raw[..nl].Trim();

        // 2) fallback – starý ROWID styl
        var idx = raw.IndexOf("ROWID", StringComparison.OrdinalIgnoreCase);
        if (idx > 0)
            return raw[..idx].Trim().TrimEnd('-', ';', ',');

        return raw.Trim();
    }


    var i = 0; // čítač pro unikátní ID collapse řádků
}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <a class="btn btn-outline-light me-2" href="@Url.Action("Admin", "Home")">← Zpět</a>
        <span class="h3 text-white mb-0">Log operací</span>
    </div>
</div>

<div class="table-responsive glass p-2">
    <table class="table table-dark table-striped align-middle mb-0">
        <thead>
            <tr>
                <th style="width:40px;"></th>
                <th>Čas</th>
                <th>Tabulka</th>
                <th>Operace</th>
                <th>Kdo</th>
                <th>Popis (shrnutí)</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var x in Model)
            {
                var rowId = $"logRow_{i++}";
                <tr>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-light"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#@rowId"
                                aria-expanded="false"
                                aria-controls="@rowId">
                            +
                        </button>
                    </td>
                    <td>@x.Kdy.ToString("dd.MM.yyyy HH:mm:ss")</td>
                    <td>@x.Tabulka</td>
                    <td>
                        <span class="badge @OperaceBadgeClass(x.Operace)">
                            @FormatOperace(x.Operace)
                        </span>
                    </td>
                    <td>@x.Kdo</td>
                    <td>@CleanPopis(x.Popis)</td>
                </tr>

                <tr class="collapse bg-secondary bg-opacity-25" id="@rowId">
                    <td></td>
                    <td colspan="5">
                        <div class="small">
                            <strong>Detail operace (@x.Tabulka - @x.Operace)</strong>
                            <hr class="my-2" />
                            <pre class="mb-0 text-light" style="white-space: pre-wrap; word-break: break-word;"> 
                                @x.Popis
                                </pre>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

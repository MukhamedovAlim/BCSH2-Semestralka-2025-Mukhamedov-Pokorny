@model IReadOnlyList<FitnessCenter.Domain.Entities.Member>?
@{
    ViewData["Title"] = "Povýšit člena na trenéra";
    Layout = "_AppLayout";

    ViewBag.HideMainNav = true;

    var search = ViewBag.Search as string ?? "";
    var total = Model?.Count ?? 0;
}

<div class="glass p-3">
    <div class="d-flex align-items-center gap-2 mb-3">
        <a class="btn btn-outline-light btn-sm"
           href="@Url.Action("Index", "AdminTrainers")"
           onclick="if(history.length > 1){ history.back(); return false; }">
            ← Zpět
        </a>

        <h3 class="text-white mb-0">Povýšit člena na trenéra</h3>
    </div>

    <small class="text-secondary d-block mb-2">
        K dispozici: <span class="text-light fw-semibold">@total</span> členů
    </small>

    <hr class="border-secondary" />

    @if (TempData["Ok"] is string ok)
    {
        <div class="alert alert-success">@ok</div>
    }
    @if (TempData["Err"] is string err)
    {
        <div class="alert alert-danger">@err</div>
    }

    <!-- FILTR – HLEDÁNÍ PODLE JMÉNA ČLENA -->
    <div class="bg-dark bg-opacity-50 rounded-3 p-2 p-md-3 mb-3">
        <form method="get">
            <div class="row g-2 align-items-center">
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text border-0 bg-secondary bg-opacity-50 text-light">
                            🔍
                        </span>
                        <input type="text"
                               name="search"
                               value="@search"
                               class="form-control border-0 bg-dark text-light"
                               placeholder="Hledat podle jména (např. Vojta)..." />
                    </div>
                </div>

                <div class="col-auto">
                    <button type="submit" class="btn btn-sm btn-warning">
                        Hledat
                    </button>
                </div>

                <div class="col-auto">
                    <!-- resetne input a pošle prázdný search -->
                    <button type="button"
                            class="btn btn-sm btn-outline-light"
                            onclick="this.form.search.value=''; this.form.submit();">
                        Reset
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-dark table-striped align-middle">
            <thead>
                <tr>
                    <th>Jméno</th>
                    <th>E-mail</th>
                    <th>Telefon (aktuální)</th>
                    <th class="text-end">Akce</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    foreach (var m in Model)
                    {
                        var hasPhone = !string.IsNullOrWhiteSpace(m.Phone);

                        <tr>
                            <td class="text-white">@($"{m.FirstName} {m.LastName}".Trim())</td>
                            <td>@m.Email</td>
                            <td>
                                @if (hasPhone)
                                {
                                    <span>@m.Phone</span>
                                    <div class="text-white-50 small">Použije se číslo člena.</div>
                                }
                                else
                                {
                                    <span class="text-white-50">—</span>
                                    <div class="text-white-50 small">
                                        Člen nemá telefon — můžeš ho doplnit při povýšení.
                                    </div>
                                }
                            </td>

                            <td class="text-end">
                                <form method="post"
                                      action="@Url.Action("PromoteMember", "AdminTrainers")"
                                      class="d-inline-flex gap-2 align-items-center">

                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="email" value="@m.Email" />

                                    @if (!hasPhone)
                                    {
                                        <input type="tel"
                                               name="phone"
                                               class="form-control form-control-sm"
                                               placeholder="Telefon pro trenéra"
                                               style="width:210px"
                                               pattern="(\+?420)?\s*\d{3}\s*\d{3}\s*\d{3}|\d{3}\s*\d{3}\s*\d{3}"
                                               title="Zadej 9 číslic (např. 777888999) nebo s předvolbou +420/420." />
                                    }

                                    <button type="submit" class="btn btn-sm btn-warning">
                                        Povýšit
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
